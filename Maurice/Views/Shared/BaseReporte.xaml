<?xml version="1.0" encoding="utf-8"?>
<UserControl 
    x:Class="Maurice.Views.Shared.BaseReporte"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:localConverters="using:Maurice.Core.Services">

    <UserControl.Resources>
        <converters:StringFormatConverter x:Key="StringFormatConverter" />
        <localConverters:CurrencyConverter x:Key="CurrencyConverter"/>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="600"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="130"/>
            <RowDefinition Height="200"/>
            <RowDefinition Height="160"/>
        </Grid.RowDefinitions>

        <!--#region Header-->
        <!-- Title -->
        <TextBlock 
            Text="{Binding Title}" 
            Grid.Row="0"
            Grid.Column="0"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            FontSize="20"
            FontWeight="Bold"/>
        <!-- Period selection area (injected by derived views) -->
        <Border 
            CornerRadius="5" 
            Padding="1"
            Grid.Column="1"
            Grid.Row="0"
            Margin="10">   
            <ContentControl x:Name="PeriodSelectionContent"/>
        </Border>
        <!--#endregion-->
        <!-- Status Message -->
        <TextBlock 
            Text="{Binding StatusMessage}" 
            FontWeight="SemiBold"
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Padding="0,40,0,0"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Margin="10"
            Foreground="{ThemeResource SystemAccentColor}"
            TextWrapping="Wrap"
            TextAlignment="Center"/>

        <!--#region Resumen del periodo -->
        <Border 
            Margin="15,10,0,0"
            Grid.Row="1" 
            CornerRadius="10"
            BorderBrush="Black" 
            BorderThickness="1">
            <Grid Background="#495057">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="195"/>
                    <ColumnDefinition Width="195"/>
                    <ColumnDefinition Width="195"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30"/>
                    <RowDefinition Height="30"/>
                    <RowDefinition Height="30"/>
                </Grid.RowDefinitions>

                <!--Section Title-->
                <TextBlock
                    Margin="5"
                    FontSize="16"
                    FontWeight="Bold"
                    Text="Resumen Mensual"
                    Grid.Row="0"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    HorizontalAlignment="Center"/>
                <!--Income-->
                <TextBlock
                    Margin="5,0,0,0"
                    Text="Ingresos"
                    Grid.Row="1"
                    Grid.Column="0"
                    HorizontalAlignment="Center"/>
                <TextBlock
                    Margin="5,0,0,0"
                    Text="{Binding TotalIncomes,Converter={StaticResource CurrencyConverter}}"
                    Foreground="#38b000"
                    FontWeight="Bold"
                    Grid.Row="2"
                    Grid.Column="0"
                    HorizontalAlignment="Center"/>
                <!--Expense-->
                <TextBlock
                    Text="Egreso"
                    Grid.Row="1"
                    Grid.Column="1"
                    HorizontalAlignment="Center"/>
                <TextBlock
                    Text="{Binding TotalExpenses,Converter={StaticResource CurrencyConverter}}"
                    Foreground="#d62828"
                    FontWeight="Bold"
                    Grid.Row="2"
                    Grid.Column="1"
                    HorizontalAlignment="Center"/>
                <!--Balance-->
                <TextBlock
                    Text="Balance"
                    Grid.Row="1"
                    Grid.Column="2"
                    HorizontalAlignment="Center"/>
                <TextBlock
                    x:Name="BalanceValue"
                    Text="{Binding NetAmount,Converter={StaticResource CurrencyConverter}}"
                    Foreground="#4895ef"
                    FontWeight="Bold"
                    Grid.Row="2"
                    Grid.Column="2"
                    Grid.ColumnSpan="3"
                    HorizontalAlignment="Center"/>
                <!-- The TeachingTip element -->
                <TeachingTip 
                    x:Name="ExplanationTip"
                    Title="Balance Total"
                    Subtitle="Este valor es el Ingreso menos el Egreso e IVA trasladado."
                    Target="{x:Bind BalanceValue}"
                    IsLightDismissEnabled="True"
                    PlacementMargin="5"
                    IsOpen="True" />
            </Grid>
        </Border>
        <!--#endregion-->

        <!--#region ListView-->
        <Border
            Grid.Row="2"
            Grid.RowSpan="3"
            Margin="15,10,0,0"
            CornerRadius="10"
            BorderBrush="Black" 
            BorderThickness="1">
            <ListView  
                ItemsSource="{Binding ReportResult}"
                MaxHeight="350"
                Background="#495057">
                <ListView.Header>
                    <Grid Background="{ThemeResource SubtleFillColorSecondaryBrush}" Padding="12">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="120"/>
                            <ColumnDefinition Width="80"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="100"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBlock Text="RFC" FontWeight="Bold"/>
                        <TextBlock Text="Folio" FontWeight="Bold" Grid.Column="1"/>
                        <TextBlock Text="Fecha" FontWeight="Bold" Grid.Column="2"/>
                        <TextBlock Text="Total" FontWeight="Bold" Grid.Column="3"/>
                        <TextBlock Text="Tipo" FontWeight="Bold" Grid.Column="4"/>
                    </Grid>
                </ListView.Header>

                <ListView.ItemTemplate>
                    <DataTemplate>
                        <Grid Padding="1">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="120"/>
                                <ColumnDefinition Width="80"/>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="100"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <TextBlock Text="{Binding RfcEmisor}" FontWeight="SemiBold" Margin="-8,0,0,0" />
                            <TextBlock Text="{Binding Folio}" Grid.Column="1"/>
                            <TextBlock Text="{Binding Fecha, Converter={StaticResource StringFormatConverter},ConverterParameter='{}{0:dd/MM/yyyy}'}" Grid.Column="2"/>
                            <TextBlock Text="{Binding Total,Converter={StaticResource CurrencyConverter}}" Grid.Column="3"/>
                            <TextBlock Text="{Binding TipoDeDocumento}" Grid.Column="4"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </Border>
        <!--#endregion-->

        <!--#region Detalles ingresos-->
        <Border 
            Margin="15,10,15,0"
            Grid.Row="1" 
            Grid.Column="1"
            CornerRadius="10"
            BorderBrush="Black" 
            BorderThickness="1">
            <Grid Background="#495057">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!--Section Title-->
                <TextBlock
                    Margin="5"
                    Text="Ingresos"
                    FontSize="16"
                    FontWeight="Bold"
                    Grid.Row="0"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    HorizontalAlignment="Center"/>
                <StackPanel
                    Grid.Row="1">
                    <TextBlock
                        Text="Facturado"
                        Margin="10,0"/>

                    <TextBlock
                        HorizontalAlignment="Right"
                        Margin="10,0">
                        <Run Text="{Binding AmountFacturas,Converter={StaticResource CurrencyConverter}}"/>
                        <Run Text=" en "/>
                        <Run Text="{Binding NumberOfFacturas}"/>
                        <Run Text=" Facturas"/>
                    </TextBlock>
                    <TextBlock
                        Text="Nominas"
                        Margin="10,0"/>
                    <TextBlock
                        HorizontalAlignment="Right"
                        Margin="10,0">
                        <Run Text="{Binding AmountNominas,Converter={StaticResource CurrencyConverter}}"/>
                        <Run Text=" en "/>
                        <Run Text="{Binding NumberOfNominas}"/>
                        <Run Text=" Nominas"/>                    
                    </TextBlock>

                </StackPanel>
            </Grid>
        </Border>
        <!--#endregion-->

        <!--#region Detalles egresos-->
        <Border 
            Margin="15,10,15,0"
            Grid.Row="2" 
            Grid.Column="1"
            CornerRadius="10"
            BorderBrush="Black" 
            BorderThickness="1">
            <Grid Background="#495057">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!--Section Title-->
                <TextBlock
                    Margin="5"
                    Text="Egresos"
                    FontSize="16"
                    FontWeight="Bold"
                    Grid.Row="0"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    HorizontalAlignment="Center"/>
                <StackPanel
                    Grid.Row="1">
                    <TextBlock
                        Text="Facturado"
                        Margin="10,0"/>
                    <TextBlock
                        Text="200 en 4 Facturas"
                        HorizontalAlignment="Right"
                        Margin="10,0"/>
                    <TextBlock
                        Text="Nominas"
                        Margin="10,0"/>
                    <TextBlock
                        Text="200 en 4 Nominas"
                        HorizontalAlignment="Right"
                        Margin="10,0"/>

                </StackPanel>
            </Grid>
        </Border>
        <!--#endregion-->

        <!--#region Detalles impuestos-->
        <Border 
            Margin="15,10,15,0"
            Grid.Row="3" 
            Grid.Column="1"
            CornerRadius="10"
            BorderBrush="Black" 
            BorderThickness="1">
            <Grid Background="#495057">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <!--Section Title-->
                <TextBlock
                    Margin="5"
                    Text="Impuestos"
                    FontSize="16"
                    FontWeight="Bold"
                    Grid.Row="0"
                    Grid.Column="0"
                    Grid.ColumnSpan="3"
                    HorizontalAlignment="Center"/>
                <StackPanel
                    Grid.Row="1">
                    <TextBlock
                        Text="ISR retenido" 
                        FontSize="14" 
                        FontWeight="SemiBold" 
                        Margin="10,0,0,0" 
                        HorizontalAlignment="Left"/>
                    <TextBlock
                        Text="{Binding TotalISRRetenido,Converter={StaticResource CurrencyConverter}}"
                        FontSize="14" 
                        Margin="0,0,10,0" 
                        HorizontalAlignment="Right"/>
                    <TextBlock
                        Text="IVA pagado" 
                        FontSize="14" 
                        FontWeight="SemiBold" 
                        Margin="10,0,0,0" 
                        HorizontalAlignment="Left"/>
                    <TextBlock
                        Text="{Binding TotalIVAPagado,Converter={StaticResource CurrencyConverter}}"
                        FontSize="14" 
                        Margin="0,0,10,0" 
                        HorizontalAlignment="Right"/>
                    <TextBlock
                        Text="IVA trasladado" 
                        FontSize="14" 
                        FontWeight="SemiBold" 
                        Margin="10,0,0,0" 
                        HorizontalAlignment="Left"/>
                    <TextBlock
                        Text="{Binding TotalIVAPorPagar,Converter={StaticResource CurrencyConverter}}"
                        FontSize="14" 
                        Margin="0,0,10,0" 
                        HorizontalAlignment="Right"/>

                </StackPanel>
            </Grid>
        </Border>
        <!--#endregion-->
    </Grid>
</UserControl>
