<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="Maurice.Views.Configuracion"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:Maurice.Views"
    xmlns:core="using:Maurice.Core"
    xmlns:converters="using:CommunityToolkit.WinUI.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Width="450"
    Height="800">

    <Page.Resources>
        <converters:BoolNegationConverter x:Key="BoolNegationConverter" />
    </Page.Resources>

    <Grid HorizontalAlignment="Center">
        <Grid.RowDefinitions>
            <RowDefinition Height="90"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="84"/>
            <RowDefinition Height="84"/>
            <RowDefinition Height="84"/>
            <RowDefinition Height="84"/>
            <RowDefinition Height="100" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="210"/>
            <ColumnDefinition Width="210"/>
        </Grid.ColumnDefinitions>

        <!-- Title -->
        <TextBlock 
            Text="ConfiguraciÃ³n" 
            FontSize="24" 
            FontWeight="Bold" 
            Margin="0"
            Grid.Row="0"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"/>

        <!-- Status Message -->
        <TextBlock 
            Text="{Binding StatusMessage}" 
            FontWeight="SemiBold"
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Margin="0"
            Foreground="{ThemeResource SystemAccentColor}"
            TextWrapping="Wrap"
            TextAlignment="Center"/>

        <!-- Loading Indicator -->
        <ProgressRing 
            IsActive="{Binding IsLoading}" 
            Grid.Row="1"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Height="30"
            Width="30"
            Visibility="{Binding IsLoading}"/>

        <!-- User Form -->
        <TextBox 
            Header="Nombre" 
            PlaceholderText="Nombre" 
            Grid.Row="2"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Margin="10"
            Width="400"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Text="{Binding CurrentUser.FirstName, Mode=TwoWay}"
            IsReadOnly="{Binding IsInEditMode,Converter={StaticResource BoolNegationConverter}}"
            IsEnabled="{Binding IsLoading,Converter={StaticResource BoolNegationConverter}}"/>

        <TextBox 
            Header="Apellido" 
            PlaceholderText="Apellido" 
            Grid.Row="3"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Margin="10"
            Width="400"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Text="{Binding CurrentUser.LastName, Mode=TwoWay}"
            IsReadOnly="{Binding IsInEditMode,Converter={StaticResource BoolNegationConverter}}"
            IsEnabled="{Binding IsLoading,Converter={StaticResource BoolNegationConverter}}"/>

        <TextBox 
            Header="RFC" 
            PlaceholderText="AAAN000000A01" 
            Grid.Row="4"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Margin="10"
            Width="400"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            MaxLength="13"
            CharacterCasing="Upper"
            Text="{Binding CurrentUser.Rfc, Mode=TwoWay}"
            IsReadOnly="{Binding IsInEditMode,Converter={StaticResource BoolNegationConverter}}"
            IsEnabled="{Binding IsLoading,Converter={StaticResource BoolNegationConverter}}"/>

        <TextBox
            x:Name="RegimenFiscalInput"
            Header="Regimen Fiscal"
            PlaceholderText="Regimen Fiscal" 
            Grid.Row="5"
            Grid.Column="0"
            Grid.ColumnSpan="2"
            Margin="10"
            Width="400"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            IsReadOnly="True"
            GotFocus="ShowPopupOffset"
            Text="{Binding RegimenFiscalInputText}"
            IsEnabled="{Binding IsLoading,Converter={StaticResource BoolNegationConverter}}"/>

        <!--ListBox for Regimen Fiscal -->
        <Popup 
            x:Name="ListPopup" 
            VerticalOffset="120" 
            HorizontalOffset="0" 
            IsLightDismissEnabled="False">
            <Border 
                Padding="0" 
                CornerRadius="{StaticResource OverlayCornerRadius}" 
                Width="410" 
                BorderThickness="1" 
                BorderBrush="{ThemeResource SurfaceStrokeColorDefaultBrush}"
                Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}">
                <Grid 
                    Margin="0"
                    Padding="0"
                    HorizontalAlignment="Center" 
                    VerticalAlignment="Center">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="190"/>
                        <RowDefinition Height="50"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="205"/>
                        <ColumnDefinition Width="205"/>
                    </Grid.ColumnDefinitions>
                    <ListBox
                        x:Name="RegimenFiscalListBox"
                        Grid.Row="0"
                        Grid.Column="0"
                        Grid.ColumnSpan="2"
                        Margin="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Background="{ThemeResource AcrylicBackgroundFillColorDefaultBrush}"
                        ItemsSource="{Binding AvailableRegimenesFiscales}"
                        SelectionMode="Multiple"
                        DisplayMemberPath="Name"/>
                    <!-- Buttons -->
                    <Button 
                        Grid.Row="1"
                        Grid.Column="0"
                        Style="{StaticResource AccentButtonStyle}" 
                        Content="Seleccionar"
                        Click="SelectRegimenClicked"
                        HorizontalAlignment="Center"/>
                    <Button 
                        Grid.Row="1"
                        Grid.Column="1"
                        Style="{StaticResource AccentButtonStyle}" 
                        Content="Cancelar"
                        Click="ClosePopupClicked"
                        HorizontalAlignment="Center"/>
                </Grid>
            </Border>
        </Popup>
      
        <!-- Buttons -->
        <Button 
            Style="{StaticResource AccentButtonStyle}" 
            Content="{Binding SaveButtonText}"
            IsEnabled="{Binding CanSaveOrEdit}"
            Click="MainButtonClicked"
            Grid.Row="6"
            Grid.Column="0"
            HorizontalAlignment="Center"/>

        <Button 
            Content="Cancelar" 
            Grid.Row="6"
            Grid.Column="1"
            HorizontalAlignment="Center"
            IsEnabled="{Binding IsLoading,Converter={StaticResource BoolNegationConverter}}"
            Click="OnCancelButton_Click"/>
    </Grid>
</Page>